import{_ as g,r as m,o as w,c as T,f as d,t as y,d as c,w as h,e as P,a as b,b as k}from"./js/_plugin-vue_export-helper.49ea0e68.js";import{l as A}from"./js/index.f53c5df1.js";import{S as E,l as B}from"./js/index.d59f905b.js";import{l as C}from"./js/index.0b123ab1.js";import{e as I}from"./js/elemLoaded.9a6eb745.js";import{s as N}from"./js/postContent.81b4971a.js";import{i as l,g as q,d as L,s as _}from"./js/index.cda4d160.js";import{a as D}from"./js/vuex.esm-bundler.97e30e47.js";import{C as V}from"./js/Tooltip.754dc940.js";import{a as F}from"./js/constants.817c4cd3.js";import{b as M}from"./js/_baseIteratee.94079aa8.js";import{b as O}from"./js/_basePickBy.7ffadff7.js";import{g as Q}from"./js/_getAllKeysIn.a0076cbc.js";import"./js/client.e7a26247.js";import"./js/_commonjsHelpers.f84db168.js";import"./js/default-i18n.ab92175e.js";import"./js/helpers.871dba46.js";import"./js/Caret.09e548f3.js";import"./js/cleanForSlug.1b4a8fe4.js";import"./js/isArrayLikeObject.d5975086.js";import"./js/html.68197829.js";import"./js/_baseIsEqual.70af07c2.js";import"./js/_getAllKeys.81623af3.js";import"./js/_getTag.06b10d2d.js";import"./js/_baseSet.27590588.js";function U(t,e){if(t==null)return{};var r=F(Q(t),function(o){return[o]});return e=M(e),O(t,r,function(o,s){return e(o,s[0])})}const x={getTerms:async t=>{const{apiFetch:e}=window.wp,{addQueryArgs:r}=window.wp.url,o=p(t);return await e({path:r(`/wp/v2/${o.restBase}`,{per_page:-1,orderby:"count",order:"desc",_fields:"id,name"})})},getSelectedTerms:t=>{const e=p(t);return window.wp.data.select("core/editor").getEditedPostAttribute(e.restBase)||[]}},v={getTerms:async t=>{const e=[];return document.getElementById(`${t}checklist`).querySelectorAll("li").forEach(o=>{const s=o.querySelector("input").value,n=o.querySelector("label").innerText;e.push({id:parseInt(s,10),name:n.trim()})}),new Promise(o=>{o(e)})},getSelectedTerms:t=>{const e=document.getElementById(`${t}checklist`).querySelectorAll("input:checked"),r=[];return e.forEach(o=>{r.push(parseInt(o.value,10))}),r}},u=()=>{var e;return(((e=window.aioseo.postData)==null?void 0:e.taxonomies)||[]).filter(r=>r.primaryTermSupport===!0)},H=t=>u().some(e=>t===e.slug),p=t=>{const e=u().filter(r=>t===r.slug);return e.length?e[0]:{}},z=t=>l()?x.getTerms(t):v.getTerms(t),K=t=>l()?x.getSelectedTerms(t):v.getSelectedTerms(t);const R={components:{CoreTooltip:V,SvgCircleQuestionMark:E},data(){return{term:null,terms:[],selectedTerms:[],strings:{tooltip:this.$t.sprintf(this.$t.__("%1$s allows you to choose a primary category for your posts. This feature works hand in hand with our powerful Breadcrumbs template to give you full navigational control to help improve your search rankings.",this.$tdPro),"AIOSEO Pro")}}},props:{taxonomy:String},watch:{terms(t){if(!this.term&&t&&this.currentPost.primary_term[this.taxonomy]){const e=t.find(r=>r.value===this.currentPost.primary_term[this.taxonomy]);this.setPrimaryTerm(e)}},selectedTerms(t,e){if(e.length<t.length){const r=t.filter(o=>!e.includes(o))[0];this.terms.some(o=>o.value===r)||this.updateTerms()}this.term&&this.term.value&&!t.includes(this.term.value)&&this.setPrimaryTerm(null)}},computed:{...D(["currentPost"]),labelString(){const t=p(this.taxonomy).singular;return this.$t.sprintf(this.$t.__("Select Primary %1$s",this.$tdPro),t)},options(){return this.terms.filter(t=>this.selectedTerms.includes(t.value))}},methods:{setPrimaryTerm(t){this.term=t,this.$bus.$emit("standalone-update-post",{primary_term:U({...this.currentPost.primary_term,[this.taxonomy]:t&&t.value?t.value:null})})},updateTerms(){z(this.taxonomy).then(t=>{this.terms=[],t.forEach(e=>{this.terms.push({value:e.id,label:e.name})})})},updateSelectedTerms(){this.selectedTerms=K(this.taxonomy)}},async created(){await q(this.$.appContext.app)},mounted(){this.updateTerms(),this.updateSelectedTerms(),this.$bus.$on("updateSelectedTerms",this.updateSelectedTerms)},beforeUnmount(){this.$bus.$off("updateSelectedTerms",this.updateSelectedTerms)}},G={key:0,class:"aioseo-primary-term-select"},J={class:"aioseo-primary-term-select__title"},W={class:"aioseo-primary-term-select__title-text"};function X(t,e,r,o,s,n){const i=m("svg-circle-question-mark"),a=m("core-tooltip"),S=m("base-select");return 1<this.selectedTerms.length?(w(),T("div",G,[d("div",J,[d("span",W,y(n.labelString),1),c(a,{offset:"-50px,0"},{tooltip:h(()=>[P(y(s.strings.tooltip),1)]),default:h(()=>[c(i)]),_:1})]),c(S,{size:"medium",options:n.options,modelValue:s.term,"onUpdate:modelValue":e[0]||(e[0]=$=>n.setPrimaryTerm($))},null,8,["options","modelValue"])])):b("",!0)}const Y=g(R,[["render",X]]);const Z={components:{PrimaryTerm:Y},props:{taxonomy:String}},j={class:"aioseo-app aioseo-primary-term"};function tt(t,e,r,o,s,n){const i=m("primary-term");return w(),T("div",j,[c(i,{taxonomy:r.taxonomy},null,8,["taxonomy"])])}const et=g(Z,[["render",tt]]);if(l()&&window.wp){const{createElement:t,Fragment:e}=window.wp.element,{addFilter:r}=window.wp.hooks,{createHigherOrderComponent:o}=window.wp.compose,{subscribe:s}=window.wp.data;r("editor.PostTaxonomyType","aioseo/primary-term",o(n=>i=>{const{slug:a}=i;return H(a)?t(e,{},t(n,i),t("div",{id:`aioseo-primary-term-${a}`},t("div",{className:"aioseo-primary-term-app",taxonomy:a}))):t(n,i)},"withInspectorControls")),s(()=>{window.aioseoBus.$emit("updateSelectedTerms")})}L()&&u().forEach(t=>{const e=document.querySelector(`#${t.name}div .inside`);if(!e)return;const r=document.createElement("div");r.setAttribute("id",`aioseo-primary-term-${t.slug}`),r.setAttribute("class","aioseo-primary-term-app"),r.setAttribute("taxonomy",t.slug),e.append(r),function(o){o(`#${t.name}checklist`).on("change",'input[type="checkbox"]',()=>{window.aioseoBus.$emit("updateSelectedTerms")}),o(`#${t.name}checklist`).on("wpListAddEnd",()=>{window.aioseoBus.$emit("updateSelectedTerms")})}(window.jQuery)});const f=t=>{if(!t)return;const e=t.getAttribute("taxonomy");let r=k(et,{taxonomy:e});r=A(r),r=B(r),r=C(r),_._vm=r,r.use(_),r.mount(t)};if(N()&&window.aioseo&&window.aioseo.currentPost&&window.aioseo.currentPost.context==="post"){const t=document.getElementsByClassName("aioseo-primary-term-app");Array.prototype.forEach.call(t,e=>f(e)),I(".aioseo-primary-term-app","aioseoPrimaryTerm"),document.addEventListener("animationstart",function(e){e.animationName==="aioseoPrimaryTerm"&&f(e.target)},{passive:!0})}
